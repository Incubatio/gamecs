// Generated by CoffeeScript 1.4.0

/**
* @fileoverview
* This loads a TMX Map and allows you to scroll over the map
* with the cursor keys.
*
* Try to open the "data/cute.tmx" file with the Tiled map editor to
* see how the layers work and how the image for the tiles is specified.
*
* There are several useful classes inside the "view.js" module, which
* help with rendering all the layers of a map.
*
* Note how inside the tmx-file the necessary Tilesets are specified
* relative - this is the easiest way to get them to automatically load
* with the map.
*/


(function() {

  require(['gamejs', 'tilemap', 'http'], function(gamejs, TileMap, Http) {
    gamejs.preload(['/gamecs/assets/data/tilesheet.png']);
    return gamejs.ready(function() {
      var data, display, map, offset, req, tick, url;
      gamejs.Display.setCaption('TMX viewer');
      display = gamejs.Display.setMode([800, 500]);
      url = 'assets/data/example.json';
      req = Http.get(url);
      data = JSON.parse(req.response);
      console.log(data);
      data.tilesets[0].image = '/gamecs/assets/data/tilesheet.png';
      map = new TileMap(data);
      map.prepareLayers();
      offset = [0, 0];
      tick = function(msDuration) {
        var layer, _results;
        gamejs.Key.get().forEach(function(event) {
          if (event.type === gamejs.Key.KEY_DOWN) {
            switch (event.key) {
              case gamejs.Key.K_LEFT:
                return offset[0] += 50;
              case gamejs.Key.K_RIGHT:
                return offset[0] -= 50;
              case gamejs.Key.K_DOWN:
                return offset[1] -= 50;
              case gamejs.Key.K_UP:
                return offset[1] += 50;
            }
          }
        });
        display.clear();
        _results = [];
        for (layer in map.layers) {
          _results.push(display.blit(layer.image, offset));
        }
        return _results;
      };
      return gamejs.Time.fpsCallback(tick, this, 60);
    });
  });

}).call(this);
