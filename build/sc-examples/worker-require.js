// Generated by CoffeeScript 1.4.0
(function() {
  var start;

  start = new Date().getTime();

  require(['gamecs'], function(gamecs) {
    var main;
    main = function() {
      var display, font, handleEvent, tick, worker, yOffset;
      display = gamecs.Display.setMode([400, 200]);
      font = new gamecs.Font();
      gamecs.Display.setCaption("Example Worker in application context");
      worker = new Worker('build/sc-examples/workers/primes-require.js');
      yOffset = 50;
      worker.onmessage = function(event) {
        var startNumber;
        worker.onmessage = function(event) {
          return gamecs.Input.post({
            type: gamecs.Input.WORKER_RESULT,
            data: {
              prime: event.data
            }
          });
        };
        startNumber = parseInt(1230023 + (Math.random() * 10000));
        display.blit(font.render('Asking worker for primes after ' + startNumber), [100, 30]);
        return worker.postMessage({
          todo: "nextprimes",
          start: startNumber
        });
      };
      worker.onerror = function(event) {
        var error, msg;
        msg = document.getElementById("message");
        msg.innerHTML += '<div class="alert"><strong>Warning</strong> This example requires http:// context (gh-pages is file://)</div>';
        error = '<strong>Error</strong> in "' + event.filename + '" at line ' + event.lineno + ': ' + event.message;
        return msg.innerHTML += '<div class="alert alert-error">' + error + '</div>';
      };
      handleEvent = function(event) {
        var end;
        if (event.type === gamecs.Input.WORKER_RESULT) {
          display.blit(font.render('Worker answered: ' + event.data.prime), [100, yOffset]);
          yOffset += 20;
          end = new Date().getTime();
          return console.log((end - start) + 'ms');
        }
      };
      tick = function(msDuration) {
        return gamecs.Input.get().forEach(handleEvent);
      };
      return gamecs.Time.interval(tick);
    };
    return gamecs.ready(main);
  });

}).call(this);
